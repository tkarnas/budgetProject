{"remainingRequest":"/Users/tomo/Documents/projects/vue-diplomski/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/tomo/Documents/projects/vue-diplomski/src/components/ExpensesForm.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/tomo/Documents/projects/vue-diplomski/src/components/ExpensesForm.vue","mtime":1676484598000},{"path":"/Users/tomo/Documents/projects/vue-diplomski/node_modules/cache-loader/dist/cjs.js","mtime":1675708578000},{"path":"/Users/tomo/Documents/projects/vue-diplomski/node_modules/babel-loader/lib/index.js","mtime":1675708564000},{"path":"/Users/tomo/Documents/projects/vue-diplomski/node_modules/cache-loader/dist/cjs.js","mtime":1675708578000},{"path":"/Users/tomo/Documents/projects/vue-diplomski/node_modules/vue-loader/lib/index.js","mtime":1675708910000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ly8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KDQppbXBvcnQgeyBkYiwgZmlyZWJhc2UgfSBmcm9tICJAL2ZpcmViYXNlIjsNCmltcG9ydCBzdG9yZSBmcm9tICJAL3N0b3JlLmpzIjsNCmltcG9ydCBtb21lbnQgZnJvbSAibW9tZW50IjsNCg0KZXhwb3J0IGRlZmF1bHQgew0KICBuYW1lOiAiUm9sZUZvcm0iLA0KICBwcm9wczogWyJpc0FkbWluIiwgImlzVGVhbUxlYWQiLCAiaXNVc2VyIiwgImFsbFRlYW1zQW5kUHJvamVjdHMiLCAicmlnaHRzIl0sDQogIGRhdGEoKSB7DQogICAgcmV0dXJuIHsNCiAgICAgIHNlbGVjdGVkUHJvamVjdDogbnVsbCwNCiAgICAgIG51bWJlclZhbHVlOiBudWxsLA0KICAgICAgcmVhc29uOiAiIiwNCiAgICB9Ow0KICB9LA0KICBtZXRob2RzOiB7DQogICAgZ2V0VGVhbXMoKSB7DQogICAgICB0aGlzLiRlbWl0KCJjYWxsLWdldC10ZWFtcyIpOw0KICAgIH0sDQogICAgYXN5bmMgYWRkRXhwZW5zZXMoDQogICAgICBhbGxUZWFtc0FuZFByb2plY3RzLA0KICAgICAgc2VsZWN0ZWRQcm9qZWN0LA0KICAgICAgbnVtYmVyVmFsdWUsDQogICAgICByZWFzb24NCiAgICApIHsNCiAgICAgIGlmIChwYXJzZUludChudW1iZXJWYWx1ZSwgMTApIDwgMCkgew0KICAgICAgICB0aGlzLiRhbGVydCgiQ2Fubm90IGlucHV0IG5lZ2F0aXZlIG51bWJlcnMuIiwgIldhcm5pbmciLCAid2FybmluZyIpOw0KICAgICAgICByZXR1cm47DQogICAgICB9DQogICAgICBpZiAoIXNlbGVjdGVkUHJvamVjdCB8fCAhbnVtYmVyVmFsdWUgfHwgcmVhc29uID09PSAiIikgew0KICAgICAgICB0aGlzLiRhbGVydCgiRmllbGRzIGNhbm5vdCBiZSBlbXB0eS4iLCAiV2FybmluZyIsICJ3YXJuaW5nIik7DQogICAgICAgIHJldHVybjsNCiAgICAgIH0NCg0KICAgICAgY29uc3QgdGVhbSA9IGFsbFRlYW1zQW5kUHJvamVjdHMudGVhbXNXaXRoUHJvamVjdHMuZmluZCgodGVhbSkgPT4NCiAgICAgICAgdGVhbS5wcm9qZWN0cy5zb21lKA0KICAgICAgICAgIChwcm9qZWN0KSA9Pg0KICAgICAgICAgICAgcHJvamVjdC5wcm9qZWN0TmFtZSA9PT0gc2VsZWN0ZWRQcm9qZWN0LnByb2plY3ROYW1lICYmDQogICAgICAgICAgICBwcm9qZWN0LnByb2plY3RCdWRnZXQgPT09IHNlbGVjdGVkUHJvamVjdC5wcm9qZWN0QnVkZ2V0DQogICAgICAgICkNCiAgICAgICk7DQoNCiAgICAgIGlmICghdGVhbSkgew0KICAgICAgICByZXR1cm47DQogICAgICB9DQoNCiAgICAgIGNvbnN0IHByb2plY3QgPSB0ZWFtLnByb2plY3RzLmZpbmQoDQogICAgICAgIChwcm9qZWN0KSA9Pg0KICAgICAgICAgIHByb2plY3QucHJvamVjdE5hbWUgPT09IHNlbGVjdGVkUHJvamVjdC5wcm9qZWN0TmFtZSAmJg0KICAgICAgICAgIHByb2plY3QucHJvamVjdEJ1ZGdldCA9PT0gc2VsZWN0ZWRQcm9qZWN0LnByb2plY3RCdWRnZXQNCiAgICAgICk7DQoNCiAgICAgIGlmICghcHJvamVjdCkgew0KICAgICAgICByZXR1cm47DQogICAgICB9DQoNCiAgICAgIGlmIChwYXJzZUludChudW1iZXJWYWx1ZSwgMTApID4gcHJvamVjdC5wcm9qZWN0QnVkZ2V0KSB7DQogICAgICAgIHRoaXMuJGFsZXJ0KCJOdW1iZXIgdG9vIGxhcmdlLiIsICJXYXJuaW5nIiwgIndhcm5pbmciKTsNCiAgICAgICAgcmV0dXJuOw0KICAgICAgfQ0KDQogICAgICBsZXQgc3BlbnRNb25leSA9IDA7DQogICAgICBmb3IgKGNvbnN0IGV4cGVuc2Ugb2YgcHJvamVjdC5leHBlbnNlcykgew0KICAgICAgICBzcGVudE1vbmV5ICs9IGV4cGVuc2UuYW1vdW50Ow0KICAgICAgfQ0KDQogICAgICBpZiAoc3BlbnRNb25leSArIHBhcnNlSW50KG51bWJlclZhbHVlLCAxMCkgPiBwcm9qZWN0LnByb2plY3RCdWRnZXQpIHsNCiAgICAgICAgdGhpcy4kYWxlcnQoIkluc3VmZmljaWVudCBmdW5kcy4iLCAiV2FybmluZyIsICJ3YXJuaW5nIik7DQogICAgICAgIHJldHVybjsNCiAgICAgIH0NCg0KICAgICAgZGIuY29sbGVjdGlvbigidGVhbXMiKQ0KICAgICAgICAuZ2V0KCkNCiAgICAgICAgLnRoZW4oKHNuYXBzaG90KSA9PiB7DQogICAgICAgICAgaWYgKHNuYXBzaG90LmVtcHR5KSB7DQogICAgICAgICAgICBjb25zb2xlLndhcm4oImVycm9yIik7DQogICAgICAgICAgICByZXR1cm47DQogICAgICAgICAgfQ0KICAgICAgICAgIGxldCB0ZWFtSWQ7DQogICAgICAgICAgc25hcHNob3QuZm9yRWFjaCgoZG9jKSA9PiB7DQogICAgICAgICAgICBjb25zdCB0ZWFtRnJvbURCID0gZG9jLmRhdGEoKTsNCiAgICAgICAgICAgIGlmICgNCiAgICAgICAgICAgICAgdGVhbUZyb21EQi5uYW1lID09PSB0ZWFtLnRlYW1OYW1lICYmDQogICAgICAgICAgICAgIHRlYW1Gcm9tREIuYnVkZ2V0ID09PSB0ZWFtLnRlYW1CdWRnZXQNCiAgICAgICAgICAgICkgew0KICAgICAgICAgICAgICB0ZWFtSWQgPSBkb2MuaWQ7DQogICAgICAgICAgICB9DQogICAgICAgICAgfSk7DQogICAgICAgICAgY29uc3QgcHJvamVjdEluZGV4ID0gdGVhbS5wcm9qZWN0cy5pbmRleE9mKHByb2plY3QpOw0KICAgICAgICAgIGRiLmNvbGxlY3Rpb24oInRlYW1zIikNCiAgICAgICAgICAgIC5kb2ModGVhbUlkKQ0KICAgICAgICAgICAgLmdldCgpDQogICAgICAgICAgICAudGhlbigoZG9jKSA9PiB7DQogICAgICAgICAgICAgIGNvbnN0IHVwZGF0ZWRUZWFtID0gZG9jLmRhdGEoKTsNCiAgICAgICAgICAgICAgY29uc3QgdGltZSA9IG1vbWVudCgpLmZvcm1hdCgiREQgTU0gWVlZWSIpOw0KICAgICAgICAgICAgICB1cGRhdGVkVGVhbS5wcm9qZWN0c1twcm9qZWN0SW5kZXhdLmV4cGVuc2VzLnB1c2goew0KICAgICAgICAgICAgICAgIGFtb3VudDogcGFyc2VJbnQobnVtYmVyVmFsdWUsIDEwKSwNCiAgICAgICAgICAgICAgICByZWFzb246IHJlYXNvbiwNCiAgICAgICAgICAgICAgICBtb21lbnQ6IHRpbWUsDQogICAgICAgICAgICAgIH0pOw0KDQogICAgICAgICAgICAgIGRiLmNvbGxlY3Rpb24oInRlYW1zIikuZG9jKHRlYW1JZCkuc2V0KHVwZGF0ZWRUZWFtKTsNCiAgICAgICAgICAgICAgdGhpcy5nZXRUZWFtcygpOw0KICAgICAgICAgICAgICB0aGlzLiRhbGVydCgiRXhwZW5zZSBhZGRlZCIsICJTdWNjZXNzIiwgInN1Y2Nlc3MiKTsNCiAgICAgICAgICAgIH0pOw0KICAgICAgICB9KTsNCiAgICAgIHRoaXMuc2VsZWN0ZWRQcm9qZWN0ID0gbnVsbDsNCiAgICAgIHRoaXMubnVtYmVyVmFsdWUgPSBudWxsOw0KICAgICAgdGhpcy5yZWFzb24gPSAiIjsNCiAgICB9LA0KICB9LA0KICBjb21wdXRlZDogew0KICAgIHNpZ25lZFVzZXIoKSB7DQogICAgICByZXR1cm4gc3RvcmUuY3VycmVudFVzZXI7DQogICAgfSwNCiAgfSwNCn07DQo="},{"version":3,"sources":["ExpensesForm.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAuCA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"ExpensesForm.vue","sourceRoot":"src/components","sourcesContent":["<template>\r\n  <div class=\"flex\" v-if=\"isAdmin || isTeamLead\">\r\n    <div class=\"form-group\">\r\n      <h1>Add expenses</h1>\r\n      <form class=\"form-group border\">\r\n        <label for=\"select-field\">Select Project:</label>\r\n        <select id=\"select-field\" v-model=\"selectedProject\">\r\n          <option\r\n            v-for=\"(team, index) in allTeamsAndProjects.onlyProjecsts\"\r\n            :key=\"index\"\r\n            :value=\"team\"\r\n          >\r\n            {{ team.projectName }}\r\n          </option>\r\n        </select>\r\n        <label style=\"margin-top: 20px\" for=\"number-field\">Money spent:</label>\r\n        <input type=\"number\" id=\"number-field\" v-model=\"numberValue\" />\r\n        <label style=\"margin-top: 20px\" for=\"reason-field\">Reason:</label>\r\n        <input type=\"text\" id=\"reason-field\" v-model=\"reason\" />\r\n        <div\r\n          class=\"blue-button\"\r\n          style=\"margin-top: 10px\"\r\n          @click=\"\r\n            addExpenses(\r\n              allTeamsAndProjects,\r\n              selectedProject,\r\n              numberValue,\r\n              reason\r\n            )\r\n          \"\r\n        >\r\n          Submit\r\n        </div>\r\n      </form>\r\n    </div>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nimport { db, firebase } from \"@/firebase\";\r\nimport store from \"@/store.js\";\r\nimport moment from \"moment\";\r\n\r\nexport default {\r\n  name: \"RoleForm\",\r\n  props: [\"isAdmin\", \"isTeamLead\", \"isUser\", \"allTeamsAndProjects\", \"rights\"],\r\n  data() {\r\n    return {\r\n      selectedProject: null,\r\n      numberValue: null,\r\n      reason: \"\",\r\n    };\r\n  },\r\n  methods: {\r\n    getTeams() {\r\n      this.$emit(\"call-get-teams\");\r\n    },\r\n    async addExpenses(\r\n      allTeamsAndProjects,\r\n      selectedProject,\r\n      numberValue,\r\n      reason\r\n    ) {\r\n      if (parseInt(numberValue, 10) < 0) {\r\n        this.$alert(\"Cannot input negative numbers.\", \"Warning\", \"warning\");\r\n        return;\r\n      }\r\n      if (!selectedProject || !numberValue || reason === \"\") {\r\n        this.$alert(\"Fields cannot be empty.\", \"Warning\", \"warning\");\r\n        return;\r\n      }\r\n\r\n      const team = allTeamsAndProjects.teamsWithProjects.find((team) =>\r\n        team.projects.some(\r\n          (project) =>\r\n            project.projectName === selectedProject.projectName &&\r\n            project.projectBudget === selectedProject.projectBudget\r\n        )\r\n      );\r\n\r\n      if (!team) {\r\n        return;\r\n      }\r\n\r\n      const project = team.projects.find(\r\n        (project) =>\r\n          project.projectName === selectedProject.projectName &&\r\n          project.projectBudget === selectedProject.projectBudget\r\n      );\r\n\r\n      if (!project) {\r\n        return;\r\n      }\r\n\r\n      if (parseInt(numberValue, 10) > project.projectBudget) {\r\n        this.$alert(\"Number too large.\", \"Warning\", \"warning\");\r\n        return;\r\n      }\r\n\r\n      let spentMoney = 0;\r\n      for (const expense of project.expenses) {\r\n        spentMoney += expense.amount;\r\n      }\r\n\r\n      if (spentMoney + parseInt(numberValue, 10) > project.projectBudget) {\r\n        this.$alert(\"Insufficient funds.\", \"Warning\", \"warning\");\r\n        return;\r\n      }\r\n\r\n      db.collection(\"teams\")\r\n        .get()\r\n        .then((snapshot) => {\r\n          if (snapshot.empty) {\r\n            console.warn(\"error\");\r\n            return;\r\n          }\r\n          let teamId;\r\n          snapshot.forEach((doc) => {\r\n            const teamFromDB = doc.data();\r\n            if (\r\n              teamFromDB.name === team.teamName &&\r\n              teamFromDB.budget === team.teamBudget\r\n            ) {\r\n              teamId = doc.id;\r\n            }\r\n          });\r\n          const projectIndex = team.projects.indexOf(project);\r\n          db.collection(\"teams\")\r\n            .doc(teamId)\r\n            .get()\r\n            .then((doc) => {\r\n              const updatedTeam = doc.data();\r\n              const time = moment().format(\"DD MM YYYY\");\r\n              updatedTeam.projects[projectIndex].expenses.push({\r\n                amount: parseInt(numberValue, 10),\r\n                reason: reason,\r\n                moment: time,\r\n              });\r\n\r\n              db.collection(\"teams\").doc(teamId).set(updatedTeam);\r\n              this.getTeams();\r\n              this.$alert(\"Expense added\", \"Success\", \"success\");\r\n            });\r\n        });\r\n      this.selectedProject = null;\r\n      this.numberValue = null;\r\n      this.reason = \"\";\r\n    },\r\n  },\r\n  computed: {\r\n    signedUser() {\r\n      return store.currentUser;\r\n    },\r\n  },\r\n};\r\n</script>\r\n\r\n<style scoped>\r\n.blue-button {\r\n  display: block;\r\n  width: 30%;\r\n  padding: 10px;\r\n  text-align: center;\r\n  background-color: rgba(41, 133, 133, 0.3);\r\n  color: white;\r\n  border: none;\r\n  border-radius: 4px;\r\n  cursor: pointer;\r\n  border: 1px solid black;\r\n}\r\n\r\n.flex {\r\n  width: 100%;\r\n  display: flex;\r\n  justify-content: space-between;\r\n  align-items: center;\r\n}\r\n\r\n.border {\r\n  border: 1px solid black;\r\n  border-radius: 10px;\r\n  padding: 10px;\r\n  margin: 10px;\r\n  background-color: rgba(0, 0, 0, 0.1);\r\n}\r\n\r\n.form-group {\r\n  display: flex;\r\n  flex-direction: column;\r\n  width: 80%;\r\n  justify-content: space-evenly;\r\n  align-items: center;\r\n}\r\n\r\n.form-group label {\r\n  display: block;\r\n  font-weight: bold;\r\n  margin: 0px 20px;\r\n}\r\n\r\n.form-group input {\r\n  display: block;\r\n  width: 100%;\r\n  padding: 10px;\r\n  border: 1px solid #ccc;\r\n  border-radius: 4px;\r\n}\r\n\r\n.form-group select {\r\n  display: block;\r\n  width: 100%;\r\n  padding: 10px;\r\n  border: 1px solid #ccc;\r\n  border-radius: 4px;\r\n}\r\n</style>"]}]}