{"remainingRequest":"/Users/tomo/Documents/projects/vue-diplomski/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/tomo/Documents/projects/vue-diplomski/src/components/ExpensesForm.vue?vue&type=style&index=0&id=a6a209a2&scoped=true&lang=css&","dependencies":[{"path":"/Users/tomo/Documents/projects/vue-diplomski/src/components/ExpensesForm.vue","mtime":1676484598000},{"path":"/Users/tomo/Documents/projects/vue-diplomski/node_modules/css-loader/dist/cjs.js","mtime":1675708646000},{"path":"/Users/tomo/Documents/projects/vue-diplomski/node_modules/vue-loader/lib/loaders/stylePostLoader.js","mtime":1675708910000},{"path":"/Users/tomo/Documents/projects/vue-diplomski/node_modules/postcss-loader/src/index.js","mtime":1675708822000},{"path":"/Users/tomo/Documents/projects/vue-diplomski/node_modules/cache-loader/dist/cjs.js","mtime":1675708578000},{"path":"/Users/tomo/Documents/projects/vue-diplomski/node_modules/vue-loader/lib/index.js","mtime":1675708910000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:CgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCg0KLmJsdWUtYnV0dG9uIHsNCiAgZGlzcGxheTogYmxvY2s7DQogIHdpZHRoOiAzMCU7DQogIHBhZGRpbmc6IDEwcHg7DQogIHRleHQtYWxpZ246IGNlbnRlcjsNCiAgYmFja2dyb3VuZC1jb2xvcjogcmdiYSg0MSwgMTMzLCAxMzMsIDAuMyk7DQogIGNvbG9yOiB3aGl0ZTsNCiAgYm9yZGVyOiBub25lOw0KICBib3JkZXItcmFkaXVzOiA0cHg7DQogIGN1cnNvcjogcG9pbnRlcjsNCiAgYm9yZGVyOiAxcHggc29saWQgYmxhY2s7DQp9DQoNCi5mbGV4IHsNCiAgd2lkdGg6IDEwMCU7DQogIGRpc3BsYXk6IGZsZXg7DQogIGp1c3RpZnktY29udGVudDogc3BhY2UtYmV0d2VlbjsNCiAgYWxpZ24taXRlbXM6IGNlbnRlcjsNCn0NCg0KLmJvcmRlciB7DQogIGJvcmRlcjogMXB4IHNvbGlkIGJsYWNrOw0KICBib3JkZXItcmFkaXVzOiAxMHB4Ow0KICBwYWRkaW5nOiAxMHB4Ow0KICBtYXJnaW46IDEwcHg7DQogIGJhY2tncm91bmQtY29sb3I6IHJnYmEoMCwgMCwgMCwgMC4xKTsNCn0NCg0KLmZvcm0tZ3JvdXAgew0KICBkaXNwbGF5OiBmbGV4Ow0KICBmbGV4LWRpcmVjdGlvbjogY29sdW1uOw0KICB3aWR0aDogODAlOw0KICBqdXN0aWZ5LWNvbnRlbnQ6IHNwYWNlLWV2ZW5seTsNCiAgYWxpZ24taXRlbXM6IGNlbnRlcjsNCn0NCg0KLmZvcm0tZ3JvdXAgbGFiZWwgew0KICBkaXNwbGF5OiBibG9jazsNCiAgZm9udC13ZWlnaHQ6IGJvbGQ7DQogIG1hcmdpbjogMHB4IDIwcHg7DQp9DQoNCi5mb3JtLWdyb3VwIGlucHV0IHsNCiAgZGlzcGxheTogYmxvY2s7DQogIHdpZHRoOiAxMDAlOw0KICBwYWRkaW5nOiAxMHB4Ow0KICBib3JkZXI6IDFweCBzb2xpZCAjY2NjOw0KICBib3JkZXItcmFkaXVzOiA0cHg7DQp9DQoNCi5mb3JtLWdyb3VwIHNlbGVjdCB7DQogIGRpc3BsYXk6IGJsb2NrOw0KICB3aWR0aDogMTAwJTsNCiAgcGFkZGluZzogMTBweDsNCiAgYm9yZGVyOiAxcHggc29saWQgI2NjYzsNCiAgYm9yZGVyLXJhZGl1czogNHB4Ow0KfQ0K"},{"version":3,"sources":["ExpensesForm.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA8JA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA","file":"ExpensesForm.vue","sourceRoot":"src/components","sourcesContent":["<template>\r\n  <div class=\"flex\" v-if=\"isAdmin || isTeamLead\">\r\n    <div class=\"form-group\">\r\n      <h1>Add expenses</h1>\r\n      <form class=\"form-group border\">\r\n        <label for=\"select-field\">Select Project:</label>\r\n        <select id=\"select-field\" v-model=\"selectedProject\">\r\n          <option\r\n            v-for=\"(team, index) in allTeamsAndProjects.onlyProjecsts\"\r\n            :key=\"index\"\r\n            :value=\"team\"\r\n          >\r\n            {{ team.projectName }}\r\n          </option>\r\n        </select>\r\n        <label style=\"margin-top: 20px\" for=\"number-field\">Money spent:</label>\r\n        <input type=\"number\" id=\"number-field\" v-model=\"numberValue\" />\r\n        <label style=\"margin-top: 20px\" for=\"reason-field\">Reason:</label>\r\n        <input type=\"text\" id=\"reason-field\" v-model=\"reason\" />\r\n        <div\r\n          class=\"blue-button\"\r\n          style=\"margin-top: 10px\"\r\n          @click=\"\r\n            addExpenses(\r\n              allTeamsAndProjects,\r\n              selectedProject,\r\n              numberValue,\r\n              reason\r\n            )\r\n          \"\r\n        >\r\n          Submit\r\n        </div>\r\n      </form>\r\n    </div>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nimport { db, firebase } from \"@/firebase\";\r\nimport store from \"@/store.js\";\r\nimport moment from \"moment\";\r\n\r\nexport default {\r\n  name: \"RoleForm\",\r\n  props: [\"isAdmin\", \"isTeamLead\", \"isUser\", \"allTeamsAndProjects\", \"rights\"],\r\n  data() {\r\n    return {\r\n      selectedProject: null,\r\n      numberValue: null,\r\n      reason: \"\",\r\n    };\r\n  },\r\n  methods: {\r\n    getTeams() {\r\n      this.$emit(\"call-get-teams\");\r\n    },\r\n    async addExpenses(\r\n      allTeamsAndProjects,\r\n      selectedProject,\r\n      numberValue,\r\n      reason\r\n    ) {\r\n      if (parseInt(numberValue, 10) < 0) {\r\n        this.$alert(\"Cannot input negative numbers.\", \"Warning\", \"warning\");\r\n        return;\r\n      }\r\n      if (!selectedProject || !numberValue || reason === \"\") {\r\n        this.$alert(\"Fields cannot be empty.\", \"Warning\", \"warning\");\r\n        return;\r\n      }\r\n\r\n      const team = allTeamsAndProjects.teamsWithProjects.find((team) =>\r\n        team.projects.some(\r\n          (project) =>\r\n            project.projectName === selectedProject.projectName &&\r\n            project.projectBudget === selectedProject.projectBudget\r\n        )\r\n      );\r\n\r\n      if (!team) {\r\n        return;\r\n      }\r\n\r\n      const project = team.projects.find(\r\n        (project) =>\r\n          project.projectName === selectedProject.projectName &&\r\n          project.projectBudget === selectedProject.projectBudget\r\n      );\r\n\r\n      if (!project) {\r\n        return;\r\n      }\r\n\r\n      if (parseInt(numberValue, 10) > project.projectBudget) {\r\n        this.$alert(\"Number too large.\", \"Warning\", \"warning\");\r\n        return;\r\n      }\r\n\r\n      let spentMoney = 0;\r\n      for (const expense of project.expenses) {\r\n        spentMoney += expense.amount;\r\n      }\r\n\r\n      if (spentMoney + parseInt(numberValue, 10) > project.projectBudget) {\r\n        this.$alert(\"Insufficient funds.\", \"Warning\", \"warning\");\r\n        return;\r\n      }\r\n\r\n      db.collection(\"teams\")\r\n        .get()\r\n        .then((snapshot) => {\r\n          if (snapshot.empty) {\r\n            console.warn(\"error\");\r\n            return;\r\n          }\r\n          let teamId;\r\n          snapshot.forEach((doc) => {\r\n            const teamFromDB = doc.data();\r\n            if (\r\n              teamFromDB.name === team.teamName &&\r\n              teamFromDB.budget === team.teamBudget\r\n            ) {\r\n              teamId = doc.id;\r\n            }\r\n          });\r\n          const projectIndex = team.projects.indexOf(project);\r\n          db.collection(\"teams\")\r\n            .doc(teamId)\r\n            .get()\r\n            .then((doc) => {\r\n              const updatedTeam = doc.data();\r\n              const time = moment().format(\"DD MM YYYY\");\r\n              updatedTeam.projects[projectIndex].expenses.push({\r\n                amount: parseInt(numberValue, 10),\r\n                reason: reason,\r\n                moment: time,\r\n              });\r\n\r\n              db.collection(\"teams\").doc(teamId).set(updatedTeam);\r\n              this.getTeams();\r\n              this.$alert(\"Expense added\", \"Success\", \"success\");\r\n            });\r\n        });\r\n      this.selectedProject = null;\r\n      this.numberValue = null;\r\n      this.reason = \"\";\r\n    },\r\n  },\r\n  computed: {\r\n    signedUser() {\r\n      return store.currentUser;\r\n    },\r\n  },\r\n};\r\n</script>\r\n\r\n<style scoped>\r\n.blue-button {\r\n  display: block;\r\n  width: 30%;\r\n  padding: 10px;\r\n  text-align: center;\r\n  background-color: rgba(41, 133, 133, 0.3);\r\n  color: white;\r\n  border: none;\r\n  border-radius: 4px;\r\n  cursor: pointer;\r\n  border: 1px solid black;\r\n}\r\n\r\n.flex {\r\n  width: 100%;\r\n  display: flex;\r\n  justify-content: space-between;\r\n  align-items: center;\r\n}\r\n\r\n.border {\r\n  border: 1px solid black;\r\n  border-radius: 10px;\r\n  padding: 10px;\r\n  margin: 10px;\r\n  background-color: rgba(0, 0, 0, 0.1);\r\n}\r\n\r\n.form-group {\r\n  display: flex;\r\n  flex-direction: column;\r\n  width: 80%;\r\n  justify-content: space-evenly;\r\n  align-items: center;\r\n}\r\n\r\n.form-group label {\r\n  display: block;\r\n  font-weight: bold;\r\n  margin: 0px 20px;\r\n}\r\n\r\n.form-group input {\r\n  display: block;\r\n  width: 100%;\r\n  padding: 10px;\r\n  border: 1px solid #ccc;\r\n  border-radius: 4px;\r\n}\r\n\r\n.form-group select {\r\n  display: block;\r\n  width: 100%;\r\n  padding: 10px;\r\n  border: 1px solid #ccc;\r\n  border-radius: 4px;\r\n}\r\n</style>"]}]}